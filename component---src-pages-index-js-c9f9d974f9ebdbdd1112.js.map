{"version":3,"sources":["webpack:///./src/components/title/title.js","webpack:///./src/pages/index.js","webpack:///./src/functions/dom.js"],"names":["Title","className","titleStyles","titleContainer","join","title","div","chromeText","animate","backgroundImage","transition","duration","ease","subTitle","eachCarIndex","fn","i","eachCar","frameId","index","editButtonId","Index","props","state","uri","location","href","car1","car2","car3","saveOk","showSaveMessage","componentDidMount","Uri","this","editParam","getQueryParamValue","carParam","replaceQueryParam","setState","deleteQueryParam","newState","param","addQueryParam","localStorage","getItem","toString","every","val","document","framesReady","frameIdx","onElementReady","selector","callback","tries","currentTriesNumber","querySelector","setTimeout","ready","editButtonIdx","style","opacity","render","transform","carUrl","classCar","indexStyles","car","push","withCar","noCar","carLabels","thumbnail","iframe","id","src","initial","noCarThumbnail","iconButtonContainer","iconButton","onClick","setPath","window","editCar","icon","carLabelContainer","carLabel","save","saveIndex","saveParam","setItem","saveDisabled","pathname","description","carsContainer","React","Component"],"mappings":"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","file":"component---src-pages-index-js-c9f9d974f9ebdbdd1112.js","sourcesContent":["\r\nimport { motion } from 'framer-motion';\r\nimport React from 'react';\r\nimport titleStyles from './title.module.scss';\r\n\r\nexport const Title = () => {\r\n    const titleAnimation = {\r\n        backgroundImage: [\r\n            'linear-gradient(to right, #EEE, #666, #444)', \r\n            'linear-gradient(to right, #666, #EEE, #666)', \r\n            'linear-gradient(to right, #666, #666, #EEE)',\r\n            'linear-gradient(to right, #CCC, #EEE, #CCC)', \r\n        ]\r\n    };\r\n\r\n    const titleTransition = {\r\n        duration: 2,\r\n        ease: \"easeInOut\",\r\n    };\r\n\r\n    return <div className={[titleStyles.titleContainer, 'badge'].join(' ')}>\r\n        <h1 className={[titleStyles.title].join(' ')}>\r\n            <motion.div className={titleStyles.chromeText}\r\n                animate={titleAnimation}\r\n                transition={titleTransition}>\r\n                    Perfect Garage\r\n            </motion.div>\r\n        </h1>\r\n        <h4 className={titleStyles.subTitle}>Votre garage id√©al en trois voitures de sport</h4>\r\n    </div>;\r\n};","import Uri from 'jsuri';\r\nimport React from 'react';\r\nimport Layout from \"../components/layout\";\r\nimport SEO from \"../components/seo/seo\";\r\nimport { Title } from \"../components/title/title\";\r\nimport { motion } from 'framer-motion';\r\nimport './bulma-theme.scss';\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport indexStyles from './index.module.scss';\r\nimport { carLabels } from \"../constants\";\r\nimport { onElementReady } from '../functions/dom';\r\n\r\nconst eachCarIndex = fn => {\r\n    const result = []; \r\n    for (let i = 0; i < 3; i++) {\r\n        fn(i);\r\n    }\r\n    return result;\r\n}\r\n\r\nconst eachCar = fn => {\r\n    return eachCarIndex(i => fn(`car${i+1}`, i));\r\n}\r\n\r\nconst frameId = index => `frame-${index}`;\r\nconst editButtonId = index => `edit-${index}`;\r\n\r\nexport default class Index extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            uri: this.props.location.href,\r\n            car1: null,\r\n            car2: null,\r\n            car3: null,\r\n            saveOk: true,\r\n            showSaveMessage: false,\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n    \r\n        const uri = new Uri(this.state.uri);\r\n\r\n        // if edit=X parameter, save car to carX parameter\r\n        const editParam = uri.getQueryParamValue('edit');\r\n        const carParam = uri.getQueryParamValue('car');\r\n        if (editParam && carParam) {\r\n            uri.replaceQueryParam(`car${editParam}`, carParam);\r\n            this.setState({saveOk: false});\r\n        }\r\n        uri.deleteQueryParam('edit');\r\n        uri.deleteQueryParam('car');\r\n\r\n        // add missing params + save state\r\n        const newState = {...this.state};\r\n        eachCar(param => {\r\n            if (!uri.getQueryParamValue(param)) {\r\n                uri.addQueryParam(param, localStorage.getItem(param));\r\n            }\r\n            newState[param] = uri.getQueryParamValue(param);\r\n        });\r\n        newState.uri = uri.toString();\r\n\r\n        // Save button enabled?\r\n        newState.saveOk = eachCar(param => newState[param] === localStorage.getItem(param)).every(val => !!val);\r\n\r\n        this.setState(newState);\r\n\r\n        if (document) {\r\n            let framesReady = [];\r\n            eachCarIndex(frameIdx => framesReady[frameIdx] = false);\r\n            eachCarIndex(frameIdx => {\r\n                onElementReady(`#${frameId(frameIdx + 1)}`, () => {\r\n                    framesReady[frameIdx] = true;\r\n                    if (framesReady.every(ready => ready === true)) {\r\n                        setTimeout(() => {\r\n                            eachCarIndex(editButtonIdx =>\r\n                                document.querySelector(`#${editButtonId(editButtonIdx + 1)}`).style.opacity = '1')\r\n                        }, 1000);\r\n                        \r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n\r\n        const editCar = index => {\r\n            const uri = new Uri(this.state.uri);\r\n            uri.setPath('/browse');\r\n            uri.addQueryParam('edit', index);\r\n            window.location.href = uri.toString();\r\n        };\r\n\r\n        const transform = (carUrl, index) => {\r\n            const classCar = [indexStyles.car];\r\n            if (index === 2) {\r\n                classCar.push(indexStyles.car2);\r\n            }\r\n            if (carUrl) {\r\n                classCar.push(indexStyles.withCar);\r\n            } else {\r\n                classCar.push(indexStyles.noCar);\r\n            }\r\n            const title = carLabels[index-1];\r\n            const thumbnail = carUrl ? (\r\n                <motion.iframe id={frameId(index)} title={title} className={indexStyles.iframe} src={`/car/${carUrl}`}\r\n                    initial={{opacity: 0}} animate={{ opacity: 1 }}>\r\n                </motion.iframe>\r\n            ) : (\r\n                <div className={indexStyles.noCarThumbnail}>?</div>\r\n            );\r\n            return (\r\n                <div className={classCar.join(' ')}>\r\n                    <div id={editButtonId(index)} className={indexStyles.iconButtonContainer}>\r\n                        <button className={indexStyles.iconButton + \" icon-button\"} onClick={() => editCar(index)}>\r\n                            <FontAwesomeIcon icon=\"edit\" />\r\n                        </button>\r\n                    </div>                    \r\n                    {thumbnail}\r\n                    <div className={[indexStyles.carLabelContainer, 'container', 'is-full'].join(' ')}>\r\n                        <span className={[indexStyles.carLabel, 'badge'].join(' ')}>{ title }</span>\r\n                    </div>                    \r\n                </div>\r\n            );\r\n\r\n        };\r\n\r\n        const car1 = transform(this.state.car1, 1);\r\n        const car2 = transform(this.state.car2, 2);\r\n        const car3 = transform(this.state.car3, 3);\r\n\r\n        const save = () => {\r\n            for (let saveIndex = 1; saveIndex <= 3; saveIndex++) {\r\n                const saveParam = `car${saveIndex}`;\r\n                localStorage.setItem(saveParam, this.state[saveParam]);\r\n                this.setState({saveOk: true, showSaveMessage: true});\r\n                setTimeout(() => this.setState({showSaveMessage: false}), 1000)\r\n            }\r\n        }\r\n\r\n        return (\r\n            <Layout location={this.state.uri} save={save} saveDisabled={this.state.saveOk} showSaveMessage={this.state.showSaveMessage}>\r\n                <SEO location={this.props.location.pathname} title=\"\" description=\"Cr√©ez et partagez votre garage id√©al en 3 voitures de sport\" />\r\n                <Title />\r\n                <article className={indexStyles.carsContainer}>\r\n                    {car1} {car2} {car3}\r\n                </article>\r\n            </Layout>\r\n        );\r\n    }\r\n}\r\n","// Trigger callback when DOM element is ready, after some delay\r\n// because strangely window.addEventListener('ready', ...) does not work\r\nconst maxTries = 20;\r\nconst delayBetweenTries = 100;\r\nexport function onElementReady(selector, callback, tries) {\r\n\r\n    const currentTriesNumber = !tries ? 1 : tries + 1;\r\n\r\n    if (document) { // not available on server-side rendering\r\n        const element = document.querySelector(selector);\r\n        if (!element) { \r\n            if (currentTriesNumber > maxTries) {\r\n                return;\r\n            } else {\r\n                setTimeout(() => onElementReady(selector, callback, currentTriesNumber), delayBetweenTries);\r\n            }\r\n        } else {\r\n            callback();\r\n        }\r\n    } else {\r\n        return;\r\n    }\r\n}\r\n\r\n\r\n"],"sourceRoot":""}